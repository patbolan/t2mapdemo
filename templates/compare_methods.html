<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compare Methods - T2 Map Demo</title>
    
    <link rel="stylesheet" href="/static/css/shared.css">
    
    <!-- Shared JavaScript -->
    <script src="{{ url_for('static', filename='js/shared.js') }}"></script>
    
    <!-- KaTeX for math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <style>
      /* Page-specific styles */
      body { 
        padding: 2rem;
        max-width: 1200px;
        margin: 0 auto;
      }
      h1 { 
        margin-bottom: 1rem; 
        color: #333; 
      }
      
      /* Comparison grid layout */
      .comparison-grid {
        display: grid;
        grid-template-columns: auto 1fr 1fr 1fr;
        gap: 1rem;
        margin-top: 2rem;
        align-items: start;
      }
      
      /* Column headers */
      .column-header {
        text-align: center;
        margin-bottom: 0.5rem;
      }
      
      .image-title {
        margin: 0.5rem 0;
        font-weight: bold;
        color: #555;
      }
      
      /* Row headers */
      .row-header {
        font-weight: bold;
        color: var(--accent);
        padding: 0.5rem;
        text-align: right;
        white-space: nowrap;
        align-self: center;
      }
      
      /* Image cells */
      .grid-image {
        text-align: center;
      }
      
      .grid-image img {
        width: 100%;
        max-width: 300px;
        height: auto;
        border: 1px solid #ddd;
        border-radius: 6px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      
      /* Text column using details-container styling */
      .grid-details {
        background: #d1d5db;
        border-radius: 8px;
        padding: 1rem;
        line-height: 1.6;
        color: #555;
        font-size: 0.9em;
      }
      
      /* Empty cell for top-left corner */
      .empty-cell {
        grid-column: 1;
        grid-row: 1;
      }
      
      /* Responsive */
      @media (max-width: 768px) {
        .comparison-grid {
          grid-template-columns: 1fr;
          gap: 1.5rem;
        }
        
        .column-header,
        .row-header {
          text-align: left;
        }
        
        .empty-cell {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <a href="/" class="back-link">‚Üê Back to Home</a>
    
    <h1>Compare Methods</h1>
    
    <div class="info-box">
      <p>These plots are a subset of <a href="https://link.springer.com/article/10.1007/s10334-024-01186-3/figures/2">Figure 2</a> 
        from the paper, which compares the performance of two different parameter estimation methods in the synthetic 
        test set. The images are compared to the correct (ground truth) parameter maps using three different 
        visualization methods. </p>
    </div>
    
    <div class="tab-container">
      <ul class="tab-nav">
        <li><button class="tab-btn active" data-tab="static">Static</button></li>
        <li><button class="tab-btn" data-tab="slider">Slider</button></li>
        <li><button class="tab-btn" data-tab="toggle">Toggle</button></li>
      </ul>
      
      <!-- Single dynamic tab content -->
      <div class="tab-content active" id="dynamic-content">
        <div class="tab-card">
          <div class="tab-description">
            <p id="tab-description"><!-- Dynamic description --></p>
          </div>
          
          <div class="comparison-grid">
            <!-- Empty top-left corner -->
            <div class="empty-cell"></div>
            
            <!-- Column headers -->
            <div class="column-header">
              <div class="image-title">
                <div style="font-size: 1.1em;">$S_0$ Parameter Map</div>
              </div>
            </div>
            <div class="column-header">
              <div class="image-title">
                <div style="font-size: 1.1em;">$T_2$ Parameter Map</div>
              </div>
            </div>
            <div class="column-header">
              <!-- Empty header for details column -->
            </div>
            
            <!-- Row 1: Ground Truth -->
            <div class="row-header" id="row1-header">Ground Truth</div>
            <div class="grid-image">
              <img id="row1-s0-img" src="" alt="Row 1 S0">
            </div>
            <div class="grid-image">
              <img id="row1-t2-img" src="" alt="Row 1 T2">
            </div>
            <div class="grid-details">
              <p id="row1-details"><!-- Dynamic details --></p>
            </div>
            
            <!-- Row 2: NLLS Fit -->
            <div class="row-header" id="row2-header">NLLS Fit</div>
            <div class="grid-image">
              <img id="row2-s0-img" src="" alt="Row 2 S0">
            </div>
            <div class="grid-image">
              <img id="row2-t2-img" src="" alt="Row 2 T2">
            </div>
            <div class="grid-details">
              <p id="row2-details"><!-- Dynamic details --></p>
            </div>
            
            <!-- Row 3: CNN -->
            <div class="row-header" id="row3-header">CNN</div>
            <div class="grid-image">
              <img id="row3-s0-img" src="" alt="Row 3 S0">
            </div>
            <div class="grid-image">
              <img id="row3-t2-img" src="" alt="Row 3 T2">
            </div>
            <div class="grid-details">
              <p id="row3-details"><!-- Dynamic details --></p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Data injection -->
    <script id="labels-data" type="application/json">{{ labels | tojson }}</script>
    <script id="method1-data" type="application/json">{{ method1_preds | tojson }}</script>
    <script id="method2-data" type="application/json">{{ method2_preds | tojson }}</script>
    
    <script>
      // Load data from backend
      const labels = JSON.parse(document.getElementById('labels-data').textContent);
      const method1_preds = JSON.parse(document.getElementById('method1-data').textContent);
      const method2_preds = JSON.parse(document.getElementById('method2-data').textContent);
      
      // Configuration for each tab
      const tabConfig = {
        static: {
          description: `These side-by-side images show static comparisons of the parameter maps from ground truth, 
            NLLS fitting, and CNN predictions. All images are displayed simultaneously for direct visual comparison.`,
          row1: {
            header: 'Ground Truth',
            s0Data: labels.label_S0,
            t2Data: labels.label_T,
            details: 'Ground truth parameter maps generated from the synthetic data simulation.'
          },
          row2: {
            header: 'NLLS Fit',
            s0Data: method1_preds.pred_S0,
            t2Data: method1_preds.pred_T,
            details: 'Parameter maps estimated using Non-Linear Least Squares (NLLS) fitting algorithm.'
          },
          row3: {
            header: 'CNN',
            s0Data: method2_preds.pred_S0,
            t2Data: method2_preds.pred_T,
            details: 'Parameter maps estimated using Convolutional Neural Network (CNN) trained on ImageNet synthetic data.'
          }
        },
        slider: {
          description: `Use the slider to transition between different methods. This allows you to see differences 
            by smoothly blending between images, making subtle variations more apparent.`,
          row1: {
            header: 'Ground Truth',
            s0Data: labels.label_S0,
            t2Data: labels.label_T,
            details: 'Ground truth parameter maps (slider will blend between methods).'
          },
          row2: {
            header: 'NLLS Fit',
            s0Data: method1_preds.pred_S0,
            t2Data: method1_preds.pred_T,
            details: 'NLLS fit estimates (slider will blend between methods).'
          },
          row3: {
            header: 'CNN',
            s0Data: method2_preds.pred_S0,
            t2Data: method2_preds.pred_T,
            details: 'CNN estimates (slider will blend between methods).'
          }
        },
        toggle: {
          description: `Click on images to toggle between different methods. This provides an instant side-by-side 
            comparison by switching between methods at the same location.`,
          row1: {
            header: 'Ground Truth',
            s0Data: labels.label_S0,
            t2Data: labels.label_T,
            details: 'Ground truth parameter maps (click to toggle views).'
          },
          row2: {
            header: 'NLLS Fit',
            s0Data: method1_preds.pred_S0,
            t2Data: method1_preds.pred_T,
            details: 'NLLS fit estimates (click to toggle views).'
          },
          row3: {
            header: 'CNN',
            s0Data: method2_preds.pred_S0,
            t2Data: method2_preds.pred_T,
            details: 'CNN estimates (click to toggle views).'
          }
        }
      };
      
      // Function to update content based on selected tab
      function updateContent(tabKey) {
        const config = tabConfig[tabKey];
        
        let s0Colormap = 'gray';
        let tColormap = 'viridis';
        let s0Min = 0, s0Max = 1;
        let tMin = 0, tMax = 4; 
        
        // Update description
        document.getElementById('tab-description').innerHTML = config.description;
        
        // Update row 1
        document.getElementById('row1-header').textContent = config.row1.header;
        document.getElementById('row1-s0-img').src = arrayToImageSrc(config.row1.s0Data, s0Colormap, s0Min, s0Max);
        document.getElementById('row1-t2-img').src = arrayToImageSrc(config.row1.t2Data, tColormap, tMin, tMax);
        document.getElementById('row1-details').innerHTML = config.row1.details;
        
        // Update row 2
        document.getElementById('row2-header').textContent = config.row2.header;
        document.getElementById('row2-s0-img').src = arrayToImageSrc(config.row2.s0Data, s0Colormap, s0Min, s0Max);
        document.getElementById('row2-t2-img').src = arrayToImageSrc(config.row2.t2Data, tColormap, tMin, tMax);
        document.getElementById('row2-details').innerHTML = config.row2.details;
        
        // Update row 3
        document.getElementById('row3-header').textContent = config.row3.header;
        document.getElementById('row3-s0-img').src = arrayToImageSrc(config.row3.s0Data, s0Colormap, s0Min, s0Max);
        document.getElementById('row3-t2-img').src = arrayToImageSrc(config.row3.t2Data, tColormap, tMin, tMax);
        document.getElementById('row3-details').innerHTML = config.row3.details;
      }
      
      // Initialize with default tab on page load
      document.addEventListener('DOMContentLoaded', function() {
        updateContent('static');
        
        // Render math with KaTeX
        renderMathInElement(document.body, {
          delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false}
          ],
          throwOnError: false
        });
      });
      
      // Tab switching functionality
      document.querySelectorAll('.tab-btn').forEach(button => {
        button.addEventListener('click', () => {
          const tabName = button.getAttribute('data-tab');
          
          // Update button states
          document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');
          
          // Update content
          updateContent(tabName);
        });
      });
    </script>
  </body>
</html>
